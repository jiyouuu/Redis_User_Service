<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="./assets/css/style.css?v=1.2">

<title>MSA í”„ë¡œì íŠ¸</title>
<style>
    html, body {
    font-size: 15px;
    line-height: 1.5;
    }
</style>
</head>

<body class="grey_color">
    <div class="headerTop">
        <div class="center flex6">
          <h1 style="margin-right: auto;">MSA PROJECT</h1>
            <div id="divGlobalMenu">
                <ul class="flex1" id="nav-menu" >
                    <li class="home"><a href="/" title="í™ˆ">HOME</a></li>
                    <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… ë©”ë‰´ -->
                    <li class="logBtn login" id="login-menu"><a href="login.html" title="ë¡œê·¸ì¸"><span>LOGIN</span></a></li>
                    <li class="logBtn login" id="register-menu" ><a href="register.html" title="íšŒì›ê°€ì…"><span>Sign up</span></a></li>
                    
                    <!-- ë¡œê·¸ì¸ í›„ í™˜ì˜ ë©”ì‹œì§€ ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
                    <li class="logBtn welcome" id="welcome-msg" style="display:none;"></li>

                    <li class="logBtn mypage" style="display:none;" id ="mypage-menu"><a href="mypage.html" title="ë§ˆì´í˜ì´ì§€">MY PAGE</a></li>

                    <li class="logBtn logout" id="logout-menu" style="display:none;"><button id="logout-btn" style="background:none; border:none; color:#000000; font-size: 15px;    cursor:pointer;">LOGOUT</button></li>
                </ul>

            </div>
        </div>
    </div>
    
    <div class="container">
    <header>
        <h1><b>MY BLOG</b></h1>
        <p class="tagline" style="margin-top: 10px;">
        <span class="tag" id="blog-name" style = " font-size: 20px; margin-right: 5px;">ë‹‰ë„¤ì„</span>ë‹˜ì˜ í•˜ë£¨ê°€ ì´ê³³ì— ê¸°ë¡ë ê±°ì—ìš” ğŸŒˆ
        </p>

    </header>

    <div class="grid">
        <div class="main-content">
        <!--ì²«ë²ˆì§¸ ê¸€ ë‚˜ì˜´ -->
        <article class="card">
            <div class="card-content">
            <h3><b>ì²«ë²ˆì§¸ ê¸€ ì œëª© ë„£ì„ê±°ì„</b></h3>
            <p>
            ì²«ë²ˆì§¸ ê¸€ ë‚´ìš© ë„£ì„ ê±°ì„
            </p>
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <button class="btn">READ MORE &raquo;</button>
                <span class="text-right">
                <b>Comments &nbsp;</b><span class="tag-badge">0</span>
                </span>
            </div>
            </div>
        </article>

        <!-- ë‘ë²ˆì§¸ ê¸€ ë‚´ìš© ë‚˜ì˜¬ ì˜ˆì • -->
        <article class="card">
            <div class="card-content">
            <h3><b>ë‘ë²ˆì§¸ ê¸€ ì œëª© ë‚˜ì˜¬ê±°ì„</b></h3>
            <p>
            ë‘ë²ˆì§¸ ê¸€ ë‚´ìš© ë‚˜ì˜¬ ì˜ˆì • 
            </p>
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <button class="btn">READ MORE &raquo;</button>
                <span class="text-right">
                <b>Comments &nbsp;</b><span class="tag-badge">2</span>
                </span>
            </div>
            </div>
        </article>

        <!-- ì„¸ë²ˆì§¸ ê¸€ ë‚´ìš© ë‚˜ì˜¬ ì˜ˆì • -->
        <article class="card">
            <div class="card-content">
            <h3><b>ì„¸ë²ˆì§¸ ê¸€ ì œëª© ë‚˜ì˜¬ê±°ì„</b></h3>
            <p>
            ì„¸ë²ˆì§¸ ê¸€ ë‚´ìš© ë‚˜ì˜¬ ì˜ˆì • 
            </p>
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <button class="btn">READ MORE &raquo;</button>
                <span class="text-right">
                <b>Comments &nbsp;</b><span class="tag-badge">9</span>
                </span>
            </div>
            </div>
        </article>

        </div>

        <aside class="sidebar">
        <!-- ìê¸°ì†Œê°œ ì¦‰ ì‘ì€ ë§ˆì´í˜ì´ì§€ ëŠë‚Œ  -->
        <section class="card" id="user-card" style="display:none;">
            <img id="user-img" style="width:100%"; height="250px;">
            <div class="card-content">
            <h4><b id="user-nickname" style="font-size: 30px;">ë‹‰ë„¤ì„</b></h4>
            <p style="margin-top:10px"id="user-bio">ìê¸°ì†Œê°œ</p>
            </div>
        </section>

        <section class="card" id="guest-card">
            <div class="card-content">
            <h4><b>ğŸ˜Š ë¡œê·¸ì¸ í›„ ë‚˜ì˜ í”„ë¡œí•„ì„ í™•ì¸í•´ë³´ì•„ìš” ğŸ˜Š</b></h4>
            </div>
        </section>


        
        <section class="card" >
            <div class="card-content1" >
            <h2>ì£¼ê°„ì˜ ì¸ê¸° í¬ìŠ¤íŠ¸</h2>
            <ul class="list-unstyled popular-posts">
                <li>
                <div style = 'padding: 20px;'>
                    <span class="title">ì œëª©</span><br />
                    <span class="subtitle">ë‚´ìš©</span>
                </div>
                </li>
                <li>
                <div style = 'padding: 20px;'>
                    <span class="title">ì œëª©</span><br />
                    <span class="subtitle">ë‚´ìš©</span>
                </div>
                </li>
                <li>
                <div style = 'padding: 20px;'>
                    <span class="title">ì œëª©</span><br />
                    <span class="subtitle">ë‚´ìš©</span>
                </div>
                </li>
                <li>
                <div style = 'padding: 20px;'>
                    <span class="title">ì œëª©</span><br />
                    <span class="subtitle">ë‚´ìš©</span>
                </div>
                </li>
            </ul>
            </div>
        </section>

        </aside>

    </div>

    </div>


    <footer>
    <button class="btn" disabled>Previous</button>
    <button class="btn enabled">Next &raquo;</button>
    </footer>
</body>
<script>
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸í•˜ê³  ë©”ë‰´ ë°”ê¾¸ê¸°
  window.addEventListener('DOMContentLoaded', async () => {
    const loginMenu = document.getElementById('login-menu');
    const registerMenu = document.getElementById('register-menu');
    const welcomeMsg = document.getElementById('welcome-msg');
    const logoutMenu = document.getElementById('logout-menu');
    const mypageMenu = document.getElementById('mypage-menu')
    

    try {
      const res = await fetch('/api/auth/me', {
        method: 'GET',
        credentials: 'include'  // ì¿ í‚¤ í¬í•¨í•´ì„œ ìš”ì²­ ë³´ë‚´ê¸°
        // ë¸Œë¼ìš°ì €ê°€ í˜„ì¬ ë„ë©”ì¸ì˜ ì¿ í‚¤(session_id)ë¥¼ ìë™ìœ¼ë¡œ ê°™ì´ ë³´ëƒ„ â†’ ì¸ì¦ ê°€ëŠ¥
      });

      if (res.ok) {
        const user = await res.json();
        // ë¡œê·¸ì¸ ìƒíƒœ: ë¡œê·¸ì¸/íšŒì›ê°€ì… ë©”ë‰´ ìˆ¨ê¸°ê³  í™˜ì˜ ë©”ì‹œì§€ì™€ ë¡œê·¸ì•„ì›ƒ ë³´ì—¬ì£¼ê¸°
        loginMenu.style.display = 'none';
        registerMenu.style.display = 'none';

        welcomeMsg.style.display = 'inline-block';
        welcomeMsg.textContent = `${user.username}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ğŸ‘‹`;

        mypageMenu.style.display = "inline-block";
        logoutMenu.style.display = 'inline-block';
      } else {
        // ë¹„ë¡œê·¸ì¸ ìƒíƒœ: ë¡œê·¸ì¸/íšŒì›ê°€ì… ë©”ë‰´ ë³´ì´ê³ , í™˜ì˜ ë©”ì‹œì§€ì™€ ë¡œê·¸ì•„ì›ƒ ìˆ¨ê¸°ê¸°
        loginMenu.style.display = 'inline-block';
        registerMenu.style.display = 'inline-block';

        welcomeMsg.style.display = 'none';
        logoutMenu.style.display = 'none';
        mypageMenu.style.display = 'none';
      }
    } catch (error) {
      console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
      // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë¡œê·¸ì¸/íšŒì›ê°€ì… ë©”ë‰´ í‘œì‹œ
      loginMenu.style.display = 'inline-block';
      registerMenu.style.display = 'inline-block';
      welcomeMsg.style.display = 'none';
      logoutMenu.style.display = 'none';
    }
  });

  // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ
  document.addEventListener('click', async (e) => {
    if (e.target && e.target.id === 'logout-btn') {
      try {
        const res = await fetch('/api/auth/logout', {
          method: 'POST',
          credentials: 'include'
        });
        if (res.ok) {
          alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
          window.location.reload();
        } else {
          alert('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨');
        }
      } catch (err) {
        alert('ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        console.error(err);
      }
    }
  });


  //---ì‚¬ì´ë“œë°” (ë§ˆì´í˜ì´ì§€)
  async function fetchUser() {
    try{
        const res = await fetch('/api/auth/me', {
        credentials: 'include'  // â† ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ì´ë©´ ê¼­ í•„ìš”
        });
        if(!res.ok) throw new Error('ì•„ì§ ë¡œê·¸ì¸ ì•ˆë¨');

        const user = await res.json();
        document.getElementById('user-card').style.display = "block";
        document.getElementById('guest-card').style.display = "none";

        document.getElementById("user-nickname").innerText = user.username;
        document.getElementById("blog-name").innerText = user.username;
        document.getElementById("user-bio").innerText = user.bio || "ìê¸°ì†Œê°œ ì—†ìŒ";
        document.getElementById("user-img").src = user.profile_image_url;
    } 
    
    catch(err){
        // ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš° ê·¸ëŒ€ë¡œ ë‘ 
        console.log('ë¡œê·¸ì¸ ì•ˆ í•œ ìƒíƒœ')
    }
  }

  fetchUser(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ë¨
</script>

</html>
